<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Easy Car Rental | Login Page</title>
    <link rel="stylesheet" href="assets/css/UserLogin.css">
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
</head>
<body>

<!-- Wrapper Area -->
<div class="wrapper__area" id="wrapper_Area">
    <!-- Forms Area -->
    <div class="forms__area">

        <!-- Login Form -->
        <form class="login__form" id="loginForm">
            <!-- Form Title -->
            <h1 class="form__title">Customer Sign In...</h1>
            <!-- inputs Groups -->
            <div class="input__group">
                <label class="field">
                    <input type="text" name="email" placeholder="Email" id="loginEmail">
                </label>
                <span class="input__icon"><i class="bx bx-at"></i></span>
                <small class="input__error_message"></small>
            </div>
            <div class="input__group">
                <label class="field">
                    <input type="password" name="password" placeholder="Password" id="loginPassword">
                </label>
                <span class="input__icon">
                    <i class="bx bx-lock"></i>
                </span>
                <span class="showHide__Icon">
                    <i class="bx bx-hide __web-inspector-hide-shortcut__"></i>
                </span>
                <small class="input__error_message"></small>
            </div>
            <div class="form__actions">
            </div>
            <!-- Login Button -->
            <div class="submit-button">
                <a href="#">
                    <span type="button" class="submit-button login" id="loginSubmitBtn">Sign in</span>
                </a>
            </div>

        </form> <!-- End Login Form -->


        <!------------------- Sign Up Form ------------------------------>

        <form class="sign-up__form" id="signUpForm">
            <!-- Form Title -->
            <h1 class="form__title">Customer Sign Up!</h1>

            <div class="input__group">
                <label class="field">
                    <input type="text" name="email" placeholder="Email@example.com" id="signUpEmail">
                </label>
                <span class="input__icon"><i class="bx bx-at"></i></span>
                <small class="input__error_message"></small>
            </div>

            <div class="input__group">
                <label class="field">
                    <input type="password" name="password" placeholder="Password123$#%&..." id="signUpPassword">
                </label>
                <!--                <span class="input__icon"><i class="bx bx-lock"></i></span>-->
                <span class="showHide__Icon"><i class="bx bx-hide"></i></span>
                <small class="input__error_message"></small>
            </div>

            <div class="input__group">
                <label class="field">
                    <input type="text" name="nic" placeholder="NIC Number" id="nic_number">
                </label>
                <!--                <span class="input__icon"><i class="bx bx-at"></i></span>-->
                <small class="input__error_message"></small>
            </div>
            <div class="input__group">
                <div class="form-floating mb-3">
                    <input id="nicImage" name="nicImage" type="file" />
                </div>
            </div>

            <div class="input__group">
                <label class="field">
                    <input type="text" name="dlicense" placeholder="Driving licence number" id="dr_License">
                </label>
                <!--                <span class="input__icon"><i class="bx bx-at"></i></span>-->
                <small class="input__error_message"></small>
            </div>

            <div class="input__group">
                <div class="form-floating mb-3">
                    <input id="dLicenseImage" name="dlicenseImage" type="file" />
                </div>
            </div>

            <div class="input__group">
                <label class="field">
                    <input type="text" name="address" placeholder="Address" id="u_address">
                </label>
                <!--                <span class="input__icon"><i class="bx bx-at"></i></span>-->
                <small class="input__error_message"></small>
            </div>
            <div class="input__group">
                <label class="field">
                    <input type="text" name="contactNo" placeholder="Contact Number" id="cntct_num">
                </label>
                <!--                <span class="input__icon"><i class="bx bx-at"></i></span>-->
                <small class="input__error_message"></small>
            </div>



            <!-- Sign Up Button -->
            <button type="submit" class="submit-button" id="signUpSubmitBtn">Sign Up</button>

        </form> <!-- End Sign Up Form -->
    </div><!-- End Forms Area -->

    <!-- Aside Area -->
    <div class="aside__area" id="aside_Area">
        <div class="login__aside-info">
            <h4>Customer</h4>
            <img src="assets/image/customer.png" alt="Image">
            <button id="aside_signUp_Btn">Sign Up</button>
        </div>
        <div class="sign-up__aside-info">
            <h4>Welcome</h4>
            <img src="assets/image/customer.png" alt="Image">
            <button id="aside_signIn_Btn">Sign In</button>
        </div>
    </div>
</div>
<!-- End Wrapper Area -->

<script src="https://unpkg.com/boxicons@latest/dist/boxicons.js"></script>
<script src="assets/js/Login.js"></script>
<script src="assets/js/jquery-3.6.0.min.js"></script>
<script>

    //-----------------add user--------------------


    var baseUrl3 = "http://localhost:8080/Back_End_war/api/v1/customer";
    var email=$('#cusID').val();
    var password=$('#cusName').val();
    var nic=$('#cusAddress').val();
    var nicImage=$('#cusContact').val();
    var dlicense=$('#cusEmail').val();
    var dlicenseImage=$('#cusNic').val();
    var address=$('#cusNic').val();
    var contactNo=$('#cusNic').val();

    var fileObjectNic1 = $('#imgNiCFront')[0].files[0];
    var fileNameNic1 = id + "-nicfront-" + $('#imgNiCFront')[0].files[0].name;
    var data = new FormData();
    data.append("nicf", fileObjectNic1, fileNameNic1);
    data.append("nicb", fileObjectNic2, fileNameNic2);
    data.append("licenceImg", fileObjectLicence, fileNameLicence);
    var cusotmer = {
        customerId: cusID,
        name: cusName,
        address: cusaddress,
        contactNo: contact,
        email: cusEmail,
        nicNo: cusNicNo,
        nicFrontImg:fileObjectNic1,
        nicBackImg:nicBackImg,

    }
    function saveCustomer() {

        $.ajax({
            url: baseUrl3,
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify(cusotmer),
            success: function (resp) {
                if (resp.data() === true) {
                    clearSignupTextFields();
                }
                alert(resp.massage);
            },
            error: function (ob) {

                alert(ob.massage);
            }
        });

    }
    function clearSignupTextFields(){
        $("#cusName").val('');
        $("#cusAddress").val('');
        $("#cusContact").val('');
        $("#cusNic").val('');
        $("#cusUserName").val('');
        $("#password").val('');
        $("#cusEmail").val('');
        $("#imgNiCFront").val('');

    }

    //---------------------------------login---------------------------------------------------

    $("#loginSubmitBtn").click(function () {

        let re_email = $("#loginEmail").val();
        let re_pass = $("#loginPassword").val()
        $.ajax({
            method: "POST",
            url: "http://localhost:8080/BackEnd_war/api/v1/customer/login",
            contentType: 'application/json',
            data: JSON.stringify({
                email: re_email,
                password: re_pass
            }),
            success: function (data) {
                if (data.code == "200") {
                    window.location.href = "http://localhost:63342/Car_Rental_System/FrontEnd/userPage.html?_ijt=7cvc1bef7gai473t32vd69760s"
                }
            }
        });

    });

    //-----------get all registration--------------------------------------

    loadAllRegistrations();

    function loadAllRegistrations() {
        $("#tblUser").empty();
        $.ajax({
            url: "http://localhost:8080/BackEnd_war/api/v1/registration",
            method: "GET",
            async: true,
            dataType: "json",
            success: function (data, textState, xhr) {

                for (let i of data.data) {
                    var row = `<tr><td>${i.email}</td><td>${i.password}</td><td>${i.nic}</td><td>${i.nicImage}</td><td>${i.dLicense}</td><td>${i.dLicenseImage}</td><td>${i.address}</td><td>${i.contactNo}</td></tr>`;

                    $("#tblUser").append(row);
                }
            }
        });
    }

    //---------validation-------------

    function checkvalidationUser() {

        let usEmail = $('#signUpEmail').val();
        let usPassword = $('#signUpPassword').val();
        let usNic = $('#nic_number').val();
        let usNicImg = $('#nicImage').val();
        let usDrivingLic = $('#dr_License').val();
        let usDrivingLicImg = $('#dLicenseImage').val();
        let usAddress = $('#u_address').val();
        let usContact = $('#cntct_num').val();

        if (usEmail!=""){
            if (usPassword!=""){
                if(usNic!=""){
                    if (usNicImg!=""){
                        if (usDrivingLic!=""){
                            if (usDrivingLicImg!=""){
                                if (usAddress!=""){
                                    if (usContact){
                                        return true;
                                    }else{
                                        alert("Please Enter Contact Number");
                                        return false;
                                    }
                                }else{
                                    alert("Please Enter Address");
                                    return false;
                                }
                            }else{
                                alert("Please Add License Image");
                                return false;
                            }
                        }else{
                            alert("Please Enter Driving Licence No");
                            return false;
                        }
                    }else{
                        alert("Please Add NIC Image");
                        return false;
                    }
                }else{
                    alert("Please Enter NIC Number");
                    return false;
                }
            }else {
                alert("Please Enter Password");
                return false;
            }
        }else{
            alert("Please Enter Email");
            return false;
        }

    }
</script>



</body>
</html>