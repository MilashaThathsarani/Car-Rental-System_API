<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Easy Car Rental | Login Page</title>
    <link rel="stylesheet" href="assests/css/UserLogin.css">
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
</head>
<body>

<!-- Wrapper Area -->
<div class="wrapper__area" id="wrapper_Area">
    <!-- Forms Area -->
    <div class="forms__area">

        <!-- Login Form -->
        <form class="login__form" id="loginForm">
            <!-- Form Title -->
            <h1 class="form__title">Sign In!</h1>
            <!-- inputs Groups -->
            <div class="input__group">
                <label class="field">
                    <input type="text" name="email" placeholder="Email" id="loginEmail">
                </label>
                <span class="input__icon"><i class="bx bx-at"></i></span>
                <small class="input__error_message"></small>
            </div>
            <div class="input__group">
                <label class="field">
                    <input type="password" name="password" placeholder="Password" id="loginPassword">
                </label>
                <span class="input__icon">
                    <i class="bx bx-lock"></i>
                </span>
                <span class="showHide__Icon">
                    <i class="bx bx-hide __web-inspector-hide-shortcut__"></i>
                </span>
                <small class="input__error_message"></small>
            </div>
            <div class="form__actions">
                <!--                <label for="checkboxInput" class="remeber_me">-->
                <!--                    <input type="checkbox" id="checkboxInput">-->
                <!--                    <span class="checkmark"></span>-->
                <!--                    <span>Remeber Me</span>-->
                <!--                </label>-->
                <!--                <div class="forgot_password">Forgot Password?</div>-->
            </div>
            <!-- Login Button -->
            <div class="submit-button">
                <a href="#">
                    <span type="button" class="submit-button login" id="loginSubmitBtn">Sign in</span>
                </a>
            </div>


            <!-- Alternate Login -->
            <!--            <div class="alternate-login">-->
            <!--                <div class="link">-->
            <!--                    <i class='bx bxl-google'></i>-->
            <!--                    <span>Google</span>-->
            <!--                </div>-->
            <!--                <div class="link">-->
            <!--                    <i class='bx bxl-facebook-circle'></i>-->
            <!--                    <span>Facebook</span>-->
            <!--                </div>-->
            <!--            </div>-->
        </form> <!-- End Login Form -->




        <!------------------- Sign Up Form ------------------------------>

        <form class="sign-up__form" id="signUpForm">
            <!-- Form Title -->
            <h1 class="form__title">Sign Up!</h1>
            <!-- inputs Groups -->
            <!--            <div class="input__group">-->
            <!--                <label class="field">-->
            <!--                    <input type="text" name="username" placeholder="Username123..." id="signUpUsername">-->
            <!--                </label>-->
            <!--                <span class="input__icon"><i class="bx bx-user"></i></span>-->
            <!--                <small class="input__error_message"></small>-->
            <!--            </div>-->
            <div class="input__group">
                <label class="field">
                    <input type="text" name="email" placeholder="Email@example.com" id="signUpEmail">
                </label>
                <span class="input__icon"><i class="bx bx-at"></i></span>
                <small class="input__error_message"></small>
            </div>

            <div class="input__group">
                <label class="field">
                    <input type="password" name="password" placeholder="Password123$#%&..." id="signUpPassword">
                </label>
                <!--                <span class="input__icon"><i class="bx bx-lock"></i></span>-->
                <span class="showHide__Icon"><i class="bx bx-hide"></i></span>
                <small class="input__error_message"></small>
            </div>

            <div class="input__group">
                <label class="field">
                    <input type="text" name="nic" placeholder="NIC Number" id="nic_number">
                </label>
                <!--                <span class="input__icon"><i class="bx bx-at"></i></span>-->
                <small class="input__error_message"></small>
            </div>
            <div class="input__group">
                <div class="form-floating mb-3">
                    <input id="nicImage" name="nicImage" type="file" />
                </div>
            </div>

            <div class="input__group">
                <label class="field">
                    <input type="text" name="dLicense" placeholder="Driving licens number" id="dr_License">
                </label>
                <!--                <span class="input__icon"><i class="bx bx-at"></i></span>-->
                <small class="input__error_message"></small>
            </div>

            <div class="input__group">
                <div class="form-floating mb-3">
                    <input id="dLicenseImage" name="dLicenseImage" type="file" />
                </div>
            </div>

            <div class="input__group">
                <label class="field">
                    <input type="text" name="address" placeholder="Address" id="u_address">
                </label>
                <!--                <span class="input__icon"><i class="bx bx-at"></i></span>-->
                <small class="input__error_message"></small>
            </div>
            <div class="input__group">
                <label class="field">
                    <input type="text" name="contactNo" placeholder="Contact Number" id="cntct_num">
                </label>
                <!--                <span class="input__icon"><i class="bx bx-at"></i></span>-->
                <small class="input__error_message"></small>
            </div>



            <!-- Sign Up Button -->
            <button type="submit" class="submit-button" id="signUpSubmitBtn">Sign Up</button>

        </form> <!-- End Sign Up Form -->
    </div><!-- End Forms Area -->

    <!-- Aside Area -->
    <div class="aside__area" id="aside_Area">
        <div class="login__aside-info">
            <h4>Hello</h4>
            <img src="https://d.top4top.io/p_1945xjz2y1.png" alt="Image">
            <p>Enter your personal details and start journey with us</p>
            <button id="aside_signUp_Btn">Sign Up</button>
        </div>
        <div class="sign-up__aside-info">
            <h4>Welcome</h4>
            <img src="https://e.top4top.io/p_1945sidbp2.png" alt="Image">
            <p>To Keep connected with us please login with your personal info</p>
            <button id="aside_signIn_Btn">Sign In</button>
        </div>
    </div>
</div>
<!-- End Wrapper Area -->

<script src="https://unpkg.com/boxicons@latest/dist/boxicons.js"></script>
<script src="assests/js/Login.js"></script>
<script src="assests/js/jquery-3.6.0.min.js"></script>
<script>

    //-----------------add user--------------------

    $("#signUpSubmitBtn").click(()=>{

        if (checkvalidationUser()){
            //-----upload nic image file----------------------
            var fileObject = $("#nicImage")[0].files[0];//access file object from input field
            var fileName = $("#nicImage")[0].files[0].name; //get file name
            var data = new FormData(); //setup form data object to send file data
            data.append("myFile", fileObject, fileName); //append data
            $.ajax({
                url: "http://localhost:8080/Easy_Car_Rental_BachEnd_war_exploded/api/v1/regisration",
                method: "POST",
                async: true,
                processData: false, //stop processing data of request body
                contentType: false, // stop setting content type by jQuery
                data: data,
                success: function () {
                    alert("File Uploaded");

                    //-----upload lic image file----------------------

                    var fileObjectL = $("#dLicenseImage")[0].files[0];//access file object from input field
                    var fileNameL = $("#dLicenseImage")[0].files[0].name; //get file name
                    var dataL = new FormData(); //setup form data object to send file data
                    dataL.append("myFile", fileObjectL, fileNameL); //append data
                    $.ajax({
                        url: "http://localhost:8080/Easy_Car_Rental_BachEnd_war_exploded/api/v1/regisration",
                        method: "POST",
                        async: true,
                        processData: false, //stop processing data of request body
                        contentType: false, // stop setting content type by jQuery
                        data: dataL,
                        success: function () {

                            alert("File Uploaded");
                            let re_email = $("#signUpEmail").val();
                            let re_pass = $("#signUpPassword").val();
                            let re_nic = $("#nic_number").val();
                            let re_nicImg = $("#nicImage").val();
                            let re_lic = $("#dr_License").val();
                            let re_licImg = $("#dLicenseImage").val();
                            let re_address = $("#u_address").val();
                            let re_cntct = $("#cntct_num").val();

                            $.ajax({
                                method: "POST",
                                url: "http://localhost:8080/Easy_Car_Rental_BachEnd_war_exploded/api/v1/regisration",
                                contentType: 'application/json',
                                async: true,
                                data: JSON.stringify({
                                    email: re_email,
                                    password: re_pass,
                                    nic: re_nic,
                                    nicImage: re_nicImg,
                                    dlicense: re_lic,
                                    dlicenseImage: re_licImg,
                                    address: re_address,
                                    contactNo: Number.parseInt(re_cntct),

                                }),
                                success: function (data) {
                                    if(data.message=='Success'){
                                        alert('Registration Successful');
                                    }
                                    console.log(data);
                                    loadAllRegistrations();
                                },
                                error: function (ob, textStatus, error) {
                                    console.log("error from : " + ob + " " + textStatus + " " + error);
                                    if(data.message!='Success'){
                                        alert('Registration UnSuccessful! Try again');
                                    }
                                }
                            });

                        }
                    });
                }
            });
        }

    });


    //---------------------------------login---------------------------------------------------

    $("#loginSubmitBtn").click(function () {


        let re_email = $("#loginEmail").val();
        let re_pass = $("#loginPassword").val()
        $.ajax({
            method: "POST",
            url: "http://localhost:8080/Easy_Car_Rental_BachEnd_war_exploded/api/v1/regisration/login",
            contentType: 'application/json',
            async: true,
            data: JSON.stringify({
                email: re_email,
                password: re_pass
            }),
            success: function (data) {
                if(data.code=="200"){
                    window.location.href="http://localhost:63342/Easy_Car_Rental_BachEnd/Easy_Car_Rental_ForntEnd/userPage.html?_ijt=1308adrt9d1ornrtksuk5tgauq#mybooking_panel"

                }
            },
            error:function (er) {
                alert(er.responseJSON.data);
            }
        });

    });
    // $("#loginSubmitBtn").click(function () {
    //
    //     let re_email = $("#signUpEmail").val();
    //     let re_pass = $("#loginPassword").val()
    //     $.ajax({
    //         method: "PUT",
    //         url: "http://localhost:8080/Easy_Car_Rental_BachEnd_war_exploded/api/v1/regisration",
    //         contentType: 'application/json',
    //         async: true,
    //         data: JSON.stringify({
    //             email: re_email,
    //             password: re_pass,
    //
    //         }),
    //         success: function (data) {
    //             console.log(data);
    //
    //         }
    //     });
    //
    // });




    //-----------get all registration--------------------------------------

    loadAllRegistrations();

    function loadAllRegistrations() {
        $("#tblUser").empty();
        $.ajax({
            url: "http://localhost:8080/Easy_Car_Rental_BachEnd_war_exploded/api/v1/regisration",
            method: "GET",
            async: true,
            dataType: "json",
            success: function (data, textState, xhr) {

                for (let i of data.data) {
                    var row = `<tr><td>${i.email}</td><td>${i.password}</td><td>${i.nic}</td><td>${i.nicImage}</td><td>${i.dLicense}</td><td>${i.dLicenseImage}</td><td>${i.address}</td><td>${i.contactNo}</td></tr>`;

                    $("#tblUser").append(row);
                }
            }
        });
    }

    //---------validation-------------

    function checkvalidationUser() {

        let usEmail = $('#signUpEmail').val();
        let usPassword = $('#signUpPassword').val();
        let usNic = $('#nic_number').val();
        let usNicImg = $('#nicImage').val();
        let usDrivingLic = $('#dr_License').val();
        let usDrivingLicImg = $('#dLicenseImage').val();
        let usAddress = $('#u_address').val();
        let usContact = $('#cntct_num').val();

        if (usEmail!=""){
            if (usPassword!=""){
                if(usNic!=""){
                    if (usNicImg!=""){
                        if (usDrivingLic!=""){
                            if (usDrivingLicImg!=""){
                                if (usAddress!=""){
                                    if (usContact){
                                        return true;
                                    }else{
                                        alert("Please Enter Contact Number");
                                        return false;
                                    }
                                }else{
                                    alert("Please Enter Address");
                                    return false;
                                }
                            }else{
                                alert("Please Add License Image");
                                return false;
                            }
                        }else{
                            alert("Please Enter Driving Licence No");
                            return false;
                        }
                    }else{
                        alert("Please Add NIC Image");
                        return false;
                    }
                }else{
                    alert("Please Enter NIC Number");
                    return false;
                }
            }else {
                alert("Please Enter Password");
                return false;
            }
        }else{
            alert("Please Enter Email");
            return false;
        }

    }





</script>



</body>
</html>